name: Auto-generate screenshots.json

on:
  push:

jobs:
  generate-json:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT }}  # use your PAT here

      # Step 2: Generate screenshots.json
      - name: Generate screenshots.json
        run: |
          echo "[" > screenshots.json
          first=true
          for f in screenshots/*; do
            if [ "$first" = true ]; then
              first=false
            else
              echo "," >> screenshots.json
            fi
            filename=$(basename "$f" | sed 's/"/\\"/g')
            echo "  \"screenshots/$filename\"" >> screenshots.json
          done
          echo "]" >> screenshots.json

      # Step 3: Commit and push automatically
      - name: Commit and push changes
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions
          author_email: github-actions@github.com
          message: Auto-update screenshots.json
          add: "screenshots.json"
          branch: main
        env:
          GITHUB_TOKEN: ${{ secrets.PAT }}